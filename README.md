# Auth Service

## Назначение сервиса

Auth Service — микросервис безопасности, отвечающий за аутентификацию и авторизацию пользователей в распределённой системе. Сервис реализует выдачу и проверку JWT-токенов и предназначен для использования другими микросервисами (например, API Gateway) в рамках единой Kubernetes-инфраструктуры.

Цель реализации — демонстрация корректного проектирования security-сервиса в микросервисной архитектуре, а не разработка сложной бизнес-логики.

---

## Основной функционал

* Аутентификация пользователя
* Генерация JWT-токенов
* Валидация JWT-токенов
* Проверка прав доступа (основа для RBAC)
* Health-check эндпоинты для Kubernetes

---

## Технологический стек

* Язык: Python
* Веб-фреймворк: FastAPI
* Аутентификация: JWT
* Контейнеризация: Docker
* Оркестрация: Kubernetes (Minikube)

---

## Архитектурная роль в системе

Auth Service является инфраструктурным микросервисом и:

* используется другими сервисами для проверки токенов;
* не имеет прямого пользовательского интерфейса;
* разворачивается как отдельный Deployment в Kubernetes;
* масштабируется автоматически с помощью HPA.

---

## Kubernetes-компоненты

В рамках сервиса используются следующие ресурсы Kubernetes:

* **Deployment** — запуск и управление подами сервиса
* **Service (NodePort)** — доступ к сервису внутри кластера
* **Secret** — хранение JWT-секрета
* **ConfigMap** — конфигурационные параметры
* **HorizontalPodAutoscaler (HPA)** — автоматическое масштабирование
* **Liveness / Readiness Probes** — контроль состояния подов

---

## Переменные окружения

| Переменная           | Описание                       |
| -------------------- | ------------------------------ |
| `JWT_SECRET`         | Секретный ключ для подписи JWT |
| `JWT_ALGORITHM`      | Алгоритм подписи токена        |
| `JWT_EXPIRE_MINUTES` | Время жизни токена             |

Все чувствительные данные передаются через Kubernetes Secret.

---

## Запуск в Kubernetes (Minikube)

### 1. Запуск Minikube

```bash
minikube start --driver=docker
```

### 2. Применение манифестов

```bash
kubectl apply -f k8s-auth.yaml
```

### 3. Проверка состояния

```bash
kubectl get pods
kubectl get svc
kubectl get hpa
```

---

## Проверка работоспособности

### Получение URL сервиса

```bash
minikube service auth-service --url
```

### Health-check

```http
GET /health
```

Ожидаемый ответ:

```json
{"status": "ok"}
```

---

## Масштабирование

Сервис использует Horizontal Pod Autoscaler:

* Минимум подов: 1
* Максимум подов: 3
* Метрика: CPU utilization (70%)

---

## Безопасность

* JWT-токены
* Kubernetes Secrets
* Разделение ответственности между сервисами
* Готовность к интеграции с API Gateway

---

## Ограничения текущей реализации

* Отсутствует полноценная user-база (демонстрационная логика)
* Не используется HTTPS (предполагается termination на ingress)
* Metrics Server может отсутствовать в Minikube

---

## Назначение в учебном проекте

Данный сервис реализован в рамках учебного проекта по дисциплине «Распределённые программные системы» и демонстрирует:

* работу с Kubernetes;
* управление секретами;
* масштабирование и отказоустойчивость;
* базовую безопасность микросервисов.

---

## Авторы

Команда Team4
